# Cursor AI Rules for prediq.fun

## Project Context
This is a prediction market platform built with T3 Stack (Next.js 15 + tRPC + Prisma + PostgreSQL).

**IMPORTANT**: Build errors in `/src/scripts/`, `/src/app/admin/`, and admin-related files can be ignored. Focus on optimizing the core prediction market functionality (SearchBar, MarketList, event handling, user-facing features).

## Core Development Rules

### ğŸš€ Performance & Database Optimization (CRITICAL)
**ALWAYS apply these performance patterns:**

#### Prisma Query Optimization
- âœ… **Use `select` instead of `include`** when possible - only fetch needed fields
- âœ… **Limit related data** with `take: 10` (max 10-20 items)
- âœ… **Batch parallel queries** with `Promise.all()`
- âœ… **Conditional updates** - check if data needs updating before executing
- âŒ **Never use include for all fields** when only some are needed

#### React Query / tRPC Caching
**ALWAYS add these options to queries:**
```typescript
{
  staleTime: 2 * 60 * 1000, // 2 minutes
  gcTime: 10 * 60 * 1000, // 10 minutes
}
```

#### Database Connection
- âœ… **Connection pooling**: DATABASE_URL must include `?connection_limit=10&pool_timeout=10&connect_timeout=30`
- âŒ **No query logging** in development (only error/warn)

### ğŸ¯ Code Quality Rules

#### TypeScript & Validation
- âœ… **Always use Zod schemas** for input validation
- âœ… **Type all tRPC procedures** with input/output schemas
- âŒ **Never use `any` type** without explicit comment explaining why

#### UI/UX Standards
- âœ… **Add `cursor-pointer`** to all clickable elements
- âœ… **Use CSS custom properties** for colors (never mix with Tailwind)
- âœ… **Support both light/dark modes** for all components
- âœ… **Mobile-first responsive design**

#### Internationalization
- âœ… **All user-facing text** must use `useTranslations()`
- âœ… **TimeZone must be configured** as 'America/Sao_Paulo'
- âœ… **Add translations to both** `en/` and `pt/` message files

### ğŸ”§ Architecture Patterns

#### API Design
- âœ… **Use `protectedProcedure`** for authenticated routes
- âœ… **Use `publicProcedure`** only for truly public data
- âœ… **Consistent error handling** with `TRPCError`
- âœ… **Input validation** with Zod schemas

#### Database Schema
- âœ… **Use `cuid()` for primary keys** (not UUID)
- âœ… **Decimal type for financial data** (never float)
- âœ… **Platform-agnostic schema** design
- âœ… **Proper indexing** on frequently queried fields

#### Search & Filtering
- âœ… **Debounce search inputs** minimum 300ms
- âœ… **Use slug-based URLs** for SEO
- âœ… **Implement pagination** for large datasets
- âœ… **Cache search results** appropriately

### âš¡ Performance Patterns

#### Background Tasks
- âœ… **Polling intervals minimum 5 minutes** (never less than 1 minute)
- âœ… **Check if updates needed** before executing
- âœ… **Use `Promise.all()`** for parallel operations

#### Client-Side Optimization
- âœ… **Implement proper loading states**
- âœ… **Use React.memo()** for expensive components
- âœ… **Lazy load heavy components**
- âœ… **Optimize images** with Next.js Image component

### ğŸš« Never Do These
- âŒ **Raw SQL queries** (use Prisma)
- âŒ **Hardcoded data in components** (use database + cache)
- âŒ **Frequent polling** (< 5 minutes)
- âŒ **Missing error boundaries**
- âŒ **Unvalidated user inputs**
- âŒ **Mixed color systems** (Tailwind + CSS vars)

### ğŸ“‹ Code Review Checklist
Before submitting code, verify:
- [ ] Query uses `select` instead of `include` where possible
- [ ] React Query has `staleTime` and `gcTime` configured
- [ ] All inputs validated with Zod
- [ ] Clickable elements have `cursor-pointer`
- [ ] Translations added to both languages
- [ ] Performance optimizations applied
- [ ] Error handling implemented
- [ ] Types are properly defined

## Project-Specific Context
- **Database**: PostgreSQL with Prisma ORM
- **Authentication**: NextAuth.js
- **UI**: shadcn/ui with Tailwind CSS
- **Internationalization**: next-intl (pt/en)
- **Deployment**: Optimized for serverless environments

When in doubt, prioritize performance and user experience over convenience.